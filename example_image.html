<!DOCTYPE html>
<html>

<head>
    <title>대학교 합격증 만들기</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- bootstrap css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- custom css -->
    <link rel="stylesheet" href="./css/style.css">

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
</head>

<body>
    <!-- 합격증 그리기 -->
    <canvas id="canvas_pass" width="793" height="1122" style="border:1px solid">
        
    </canvas>

    <canvas id="new_canvas" width="100" height="200" style="display:none"></canvas>
    <img id="logo" src="./images/yonsei.png" style="display:none">

    <script>
        var selected_id = 22;
        var selected_name = "연세대학교";
        
        $(document).ready(function() {
            make_canvas();
        });
        
        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
                vars[key] = decodeURI(value);
            });
            return vars;
        }
        
        function make_canvas() {
            var canvas = document.getElementById("canvas_pass");
            var ctx = canvas.getContext("2d");
            ctx.globalCompositeOperation='destination-over';
            
            var items = getUrlVars();
            selected_id = items["univ_id"];
            
            var imgLogo = new Image()
            imgLogo.src = './images/univ_logo/' + selected_id + '.jpg'
            imgLogo.addEventListener('load', function(){
                ctx.globalAlpha = 0.5
                ctx.drawImage(imgLogo, 192, 270, 586-192, 652-270)
                
            var items = getUrlVars();
            if(items["save_img"]=="yes") {
                save_data();
            }
                
            },false);
            
            ctx.globalAlpha = 1.0
            ctx.font = 'bold 60px "Arial"';
            ctx.fillText("합 격 통 지 서", 222, 210);
            
            ctx.font = 'bold 23px "Arial"';
            ctx.fillText("대학학부(과)", 69, 357);
            ctx.fillText("수험번호", 69, 394);
            ctx.fillText("성명", 69, 431);
            ctx.fillText("생년월일", 69, 468);
            
            ctx.font = 'bold 23px "Arial"';
            ctx.fillText(items["part"], 232, 357);
            ctx.fillText(items["number"], 232, 394);
            ctx.fillText(items["name"], 232, 431);
            ctx.fillText(items["birth"], 232, 468);
            
            ctx.font = 'bold 30px "Arial"';
            ctx.textAlign = "center";
            ctx.fillText("위 사람은 " + items["year"] + "학년도 우리 대학교 입학", 396, 601);
            ctx.fillText("전형에 합격하였음을 통지합니다.", 396, 655);
            
            ctx.font = 'bold 30px "Arial"';
            ctx.textAlign = "center";
            ctx.fillText(items["year"] + "년 12월 20일", 396, 775);
            
            ctx.font = 'bold 40px "Arial"';
            ctx.textAlign = "center";
            ctx.fillText((items["univ_name"]+ "총장").split('').join(' '), 396, 928);    
        }
        
        function save_data() {
            var canvas = document.getElementById('canvas_pass');
            saveAs(canvas.toDataURL('image/png'), "certificate.PNG");
        }


        function saveAs(uri, filename) {
            var link = document.createElement('a');
            if (typeof link.download === 'string') {
                link.href = uri;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                window.open(uri);
            }
        }
        
        function saveAs2(uri, filename) {
             var element = document.createElement('a');
             element.setAttribute('href', 'data:text/plain;charset=utf-8,' + uri);
             element.setAttribute('download', filename);

             element.style.display = 'none';
             document.body.appendChild(element);

             element.click();

             document.body.removeChild(element);
        }
    </script>

    <!-- bootstrap script -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

    <!-- html2canvas CDM -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>

</html>