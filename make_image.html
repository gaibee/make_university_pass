<!DOCTYPE html>
<html>

<head>
    <title>대학교 합격증 만들기</title>

    <meta http-equiv="content-type" content="text/html; charset=utf-8" />

    <!-- bootstrap css -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <!-- custom css -->
    <link rel="stylesheet" href="./css/style.css">

    <!-- jquery -->
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"></script>
</head>

<body>
    <div class="capture" id="capture" style="font-weight: bold; width: 100vw; height: 141vw;">
        <div class="div-padding" style="height:19vw;"></div>
        <div class="div-center" style="text-align:center;">
            <p style="font-size:7vw;">
                합 격 통 지 서
            </p>
        </div>
        <div class="div-padding" style="height:8vw;"></div>
        <table style="margin:0vw 10vw; text-align:left; font-size:3vw;">
            <tr>
                <td style="width:20vw;">
                    대학학부(과)
                    <br> 수 험 번 호
                    <br> 성 명
                    <br> 생 년 월 일
                </td>
                <td id="st_info">
                    
                    <br> 
                    <br> 
                    <br> 
                </td>
            </tr>
        </table>
        <div class="div-padding" style="height:11vw;"></div>
        <div class="div-center" style="text-align:center; margin:0vw 12vw">
            <p id="subtitle" style="font-size:4vw;">
                위 사람은 학년도 우리 대학교 입학 전형에 합격하였음을 통지합니다.
            </p>
        </div>
        <div class="div-padding" style="height:6vw;"></div>
        <div class="div-center" style="text-align:center; margin:0vw 12vw">
            <p id="date" style="font-size:4vw;">
                 년 12월 20일
            </p>
        </div>
        <div class="div-padding" style="height:6vw;"></div>
        <div class="div-center" style="text-align:center; margin:0vw 12vw">
            <p id="president" style="font-size:6vw; letter-spacing:2vw;">
                한국대학교총장
            </p>
        </div>
        <div class="div-padding" style="height:5vw;"></div>
    </div>

    <canvas id="new_canvas" width="100" height="200" style="display:none"></canvas>
    <img id="logo" src="./images/yonsei.png" style="display:none">

    <script>
        var selected_id = 22;
        var selected_name = "연세대학교";
        
        $(document).ready(function() {
            make_html();
            make_logo_background();
        });

        function make_logo_background() {
            var myCanvas = document.getElementById("new_canvas");
            var logo = document.getElementById("logo");
            var capture = document.getElementById("capture");
            
            html2canvas(document.querySelector("#capture")).then(canvas => {
                myCanvas.width = canvas.width;
                myCanvas.height = canvas.height;
                ctx = myCanvas.getContext("2d");
                
                var vw = document.documentElement.clientWidth / 100;
                
                var ratio = logo.height / logo.width;
                
                logo.width = 20 * vw;
                logo.height = 20 * vw * ratio;
                ctx.globalAlpha = 0.3;
                ctx.drawImage(logo, 20 * vw, 30 * vw, 60 * vw, 60 * vw * ratio);
                
                var my_url = myCanvas.toDataURL();
                
                capture.style.backgroundImage = "url('" + my_url + "')";
                capture.style.backgroundRepeat = "no-repeat";
                
                // preview가 아닌 save_img가 전송되어야만 이미지 save 진행
                var items = getUrlVars();
                if(items["save_img"]=="yes") {
                    save_data();
                }
            });
        }

        function getUrlVars() {
            var vars = {};
            var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m, key, value) {
                vars[key] = decodeURI(value);
            });
            return vars;
        }

        function make_html() {
            var items = getUrlVars();
            
            $("#st_info").html(items["part"] + "<br>" + items["number"] + "<br>" + items["name"] + "<br>" + items["birth"])
            $("#subtitle").html("위 사람은 " + items["year"] + "학년도 우리 대학교 입학 전형에 합격하였음을 통지합니다.")
            $("#date").html((parseInt(items["year"]) - 1) + "년 12월 20일")
            $("#president").html(items["univ_name"] + "총장")
            
            selected_id = items["univ_id"];
            selected_name = items["univ_name"];
            
            $("#logo").attr("src", "./images/univ_logo/" + selected_id + ".jpg");
        }

        function save_data() {
            html2canvas(document.querySelector("#capture")).then(canvas => {
                saveAs(canvas.toDataURL('image/png'), "certificate.PNG");
            });
        }

        function saveAs(uri, filename) {
            var link = document.createElement('a');
            if (typeof link.download === 'string') {
                link.href = uri;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                window.open(uri);
            }
        }
        
        function download(uri, filename) {
             var element = document.createElement('a');
             element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(uri));
             element.setAttribute('download', filename);

             element.style.display = 'none';
             document.body.appendChild(element);

             element.click();

             document.body.removeChild(element);
        }
    </script>

    <!-- bootstrap script -->
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script class="jsbin" src="https://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

    <!-- html2canvas CDM -->
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>

</html>